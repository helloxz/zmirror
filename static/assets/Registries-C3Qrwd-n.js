import{r,a as j,m as q,c as F,o as k,b as n,d as l,w as t,h as i,n as M,p as x,q as S,g as O,s as A,v as G,t as H,x as J,y as K,z as P,A as Q,B as W,C as X,j as Y,E as Z,e as ee,D as le,F as te,G as ae,H as w,k as m,I as oe}from"./index-CCjO4tXn.js";/* empty css                        *//* empty css                   *//* empty css                     *//* empty css                  *//* empty css                 */const se={class:"content-card"},ne={class:"card-header"},re={class:"card-body"},ie={class:"table-container"},ge={__name:"Registries",setup(de){const _=r(!1),E=r([]),d=r(!1),f=r(""),g=r(!1),v=r(),o=j({id:null,url:"",priority:1,enabled:!0}),C={url:[{required:!0,message:"请输入镜像源URL",trigger:"blur"},{type:"url",message:"请输入有效的URL",trigger:"blur"}],priority:[{required:!0,message:"请输入优先级",trigger:"blur"},{type:"number",min:1,max:100,message:"优先级必须在1-100之间",trigger:"blur"}]},b=async()=>{_.value=!0;try{const s=await w.get("/api/registries");E.value=s.data||[]}catch(s){m.error("加载镜像源失败"),console.error(s)}finally{_.value=!1}},V=(s=null)=>{s?(f.value="编辑镜像源",Object.assign(o,s)):(f.value="添加镜像源",Object.assign(o,{id:null,url:"",priority:1,enabled:!0})),d.value=!0},B=async()=>{if(!(!v.value||!await v.value.validate().catch(()=>!1))){g.value=!0;try{const e=o.id!==null;await w[e?"put":"post"]("/api/registries",o),m.success(e?"更新成功":"添加成功"),d.value=!1,b()}catch(e){m.error("保存失败"),console.error(e)}finally{g.value=!1}}},D=async s=>{try{await oe.confirm(`确认删除镜像源 "${s.url}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await w.delete(`/api/registries/${s.id}`),m.success("删除成功"),b()}catch(e){e!=="cancel"&&(m.error("删除失败"),console.error(e))}};return q(()=>{b()}),(s,e)=>{const c=M,u=O,p=J,U=K,R=X,T=ee,y=Z,I=le,L=te,$=Y,h=ae,z=G;return k(),F("div",null,[e[13]||(e[13]=n("div",{class:"page-header"},[n("h2",{class:"page-title"},"镜像源管理"),n("p",{class:"page-description"},"管理上游Docker镜像源配置")],-1)),n("div",se,[n("div",ne,[e[7]||(e[7]=n("h3",{class:"card-title"},"镜像源列表",-1)),l(u,{type:"primary",onClick:e[0]||(e[0]=a=>V())},{default:t(()=>[l(c,null,{default:t(()=>[l(x(S))]),_:1}),e[6]||(e[6]=i(" 添加镜像源 ",-1))]),_:1,__:[6]})]),n("div",re,[n("div",ie,[A((k(),H(R,{data:E.value,stripe:"",style:{width:"100%"},"empty-text":"暂无镜像源数据"},{default:t(()=>[l(p,{prop:"id",label:"ID",width:"80"}),l(p,{prop:"url",label:"镜像源URL","min-width":"300"}),l(p,{prop:"priority",label:"优先级",width:"100",align:"center"}),l(p,{prop:"enabled",label:"状态",width:"100",align:"center"},{default:t(({row:a})=>[l(U,{type:a.enabled?"success":"danger",size:"small"},{default:t(()=>[i(P(a.enabled?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(p,{label:"操作",width:"180",align:"center"},{default:t(({row:a})=>[l(u,{size:"small",onClick:N=>V(a)},{default:t(()=>[l(c,null,{default:t(()=>[l(x(Q))]),_:1}),e[8]||(e[8]=i(" 编辑 ",-1))]),_:2,__:[8]},1032,["onClick"]),l(u,{size:"small",type:"danger",onClick:N=>D(a)},{default:t(()=>[l(c,null,{default:t(()=>[l(x(W))]),_:1}),e[9]||(e[9]=i(" 删除 ",-1))]),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[z,_.value]])])])]),l(h,{modelValue:d.value,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value=a),title:f.value,width:"500px",class:"form-dialog","close-on-click-modal":!1},{footer:t(()=>[l(u,{onClick:e[4]||(e[4]=a=>d.value=!1)},{default:t(()=>e[11]||(e[11]=[i("取消",-1)])),_:1,__:[11]}),l(u,{type:"primary",loading:g.value,onClick:B},{default:t(()=>e[12]||(e[12]=[i(" 保存 ",-1)])),_:1,__:[12]},8,["loading"])]),default:t(()=>[l($,{ref_key:"formRef",ref:v,model:o,rules:C,"label-width":"100px",class:"form-container"},{default:t(()=>[l(y,{label:"URL",prop:"url"},{default:t(()=>[l(T,{modelValue:o.url,"onUpdate:modelValue":e[1]||(e[1]=a=>o.url=a),placeholder:"请输入镜像源URL，例如：https://registry-1.docker.io"},null,8,["modelValue"])]),_:1}),l(y,{label:"优先级",prop:"priority"},{default:t(()=>[l(I,{modelValue:o.priority,"onUpdate:modelValue":e[2]||(e[2]=a=>o.priority=a),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"]),e[10]||(e[10]=n("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}}," 数值越小优先级越高 ",-1))]),_:1,__:[10]}),l(y,{label:"状态"},{default:t(()=>[l(L,{modelValue:o.enabled,"onUpdate:modelValue":e[3]||(e[3]=a=>o.enabled=a),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{ge as default};
