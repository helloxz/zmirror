import{_ as G,r as C,a as V,L as K,m as j,c as E,o as h,b as r,d as e,w as n,h as c,n as R,p as w,M as F,g as J,B as Q,N as q,O as W,P as X,e as Y,f as D,Q as Z,s as $,v as ee,t as te,x as ae,y as le,z as _,J as ne,C as oe,R as se,H as I,k as T,I as re}from"./index-B5CDqZvv.js";/* empty css                        *//* empty css                 */const ie={class:"content-card"},de={class:"card-header"},pe={style:{display:"flex",gap:"12px"}},ue={class:"card-body"},ce={class:"filter-container"},_e={class:"table-container"},ge={style:{"font-family":"monospace","font-size":"12px","word-break":"break-all"}},me={key:0},fe={key:1,style:{color:"#909399"}},he={style:{"margin-top":"16px",display:"flex","justify-content":"center"}},ye={__name:"Logs",setup(ve){const y=C(!1),g=C([]),o=V({method:"",status:"",username:"",clientIp:""}),i=V({page:1,size:100}),L=K(()=>{let t=g.value;o.method&&(t=t.filter(s=>s.method===o.method)),o.status&&(t=t.filter(s=>s.status_code.toString()===o.status)),o.username&&(t=t.filter(s=>s.username&&s.username.toLowerCase().includes(o.username.toLowerCase()))),o.clientIp&&(t=t.filter(s=>s.client_ip&&s.client_ip.includes(o.clientIp)));const a=(i.page-1)*i.size,p=a+i.size;return t.slice(a,p)}),v=async()=>{y.value=!0;try{const t=await I.get("/api/logs?limit=1000");g.value=t.data||[],g.value.sort((a,p)=>new Date(p.created_at)-new Date(a.created_at))}catch(t){T.error("加载访问日志失败"),console.error(t)}finally{y.value=!1}},m=()=>{i.page=1},P=t=>{i.page=t},k=t=>{i.size=t,i.page=1},S=async()=>{try{await re.confirm("确认清空所有访问日志吗？此操作不可恢复。","确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await I.delete("/api/logs"),T.success("日志清空成功"),v()}catch(t){t!=="cancel"&&(T.error("清空失败"),console.error(t))}},B=t=>({GET:"",POST:"success",PUT:"warning",DELETE:"danger",HEAD:"info"})[t]||"",U=t=>t>=200&&t<300?"success":t>=300&&t<400?"warning":t>=400&&t<500||t>=500?"danger":"",M=t=>t?new Date(t).toLocaleString("zh-CN"):"";return j(()=>{v()}),(t,a)=>{const p=R,s=J,d=X,z=W,f=q,x=Y,N=Z,u=ae,b=le,O=oe,H=se,A=ee;return h(),E("div",null,[a[9]||(a[9]=r("div",{class:"page-header"},[r("h2",{class:"page-title"},"访问日志"),r("p",{class:"page-description"},"查看系统访问记录和用户行为")],-1)),r("div",ie,[r("div",de,[a[8]||(a[8]=r("h3",{class:"card-title"},"访问记录",-1)),r("div",pe,[e(s,{onClick:v},{default:n(()=>[e(p,null,{default:n(()=>[e(w(F))]),_:1}),a[6]||(a[6]=c(" 刷新 ",-1))]),_:1,__:[6]}),e(s,{onClick:S,type:"danger",plain:""},{default:n(()=>[e(p,null,{default:n(()=>[e(w(Q))]),_:1}),a[7]||(a[7]=c(" 清空日志 ",-1))]),_:1,__:[7]})])]),r("div",ue,[r("div",ce,[e(N,{gutter:16},{default:n(()=>[e(f,{span:6},{default:n(()=>[e(z,{modelValue:o.method,"onUpdate:modelValue":a[0]||(a[0]=l=>o.method=l),placeholder:"请求方法",clearable:"",style:{width:"100%"},onChange:m},{default:n(()=>[e(d,{label:"GET",value:"GET"}),e(d,{label:"POST",value:"POST"}),e(d,{label:"PUT",value:"PUT"}),e(d,{label:"DELETE",value:"DELETE"}),e(d,{label:"HEAD",value:"HEAD"})]),_:1},8,["modelValue"])]),_:1}),e(f,{span:6},{default:n(()=>[e(z,{modelValue:o.status,"onUpdate:modelValue":a[1]||(a[1]=l=>o.status=l),placeholder:"状态码",clearable:"",style:{width:"100%"},onChange:m},{default:n(()=>[e(d,{label:"200 - 成功",value:"200"}),e(d,{label:"401 - 未授权",value:"401"}),e(d,{label:"403 - 禁止访问",value:"403"}),e(d,{label:"404 - 未找到",value:"404"}),e(d,{label:"500 - 服务器错误",value:"500"})]),_:1},8,["modelValue"])]),_:1}),e(f,{span:6},{default:n(()=>[e(x,{modelValue:o.username,"onUpdate:modelValue":a[2]||(a[2]=l=>o.username=l),placeholder:"用户名",clearable:"",onKeyup:D(m,["enter"])},null,8,["modelValue"])]),_:1}),e(f,{span:6},{default:n(()=>[e(x,{modelValue:o.clientIp,"onUpdate:modelValue":a[3]||(a[3]=l=>o.clientIp=l),placeholder:"客户端IP",clearable:"",onKeyup:D(m,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})]),r("div",_e,[$((h(),te(O,{data:L.value,stripe:"",style:{width:"100%"},"max-height":"600","empty-text":"暂无访问日志"},{default:n(()=>[e(u,{prop:"id",label:"ID",width:"80"}),e(u,{prop:"client_ip",label:"客户端IP",width:"140",align:"center"},{default:n(({row:l})=>[e(b,{size:"small",type:"info"},{default:n(()=>[c(_(l.client_ip),1)]),_:2},1024)]),_:1}),e(u,{prop:"method",label:"方法",width:"80",align:"center"},{default:n(({row:l})=>[e(b,{size:"small",type:B(l.method)},{default:n(()=>[c(_(l.method),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"path",label:"路径","min-width":"300"},{default:n(({row:l})=>[r("div",ge,_(l.path),1)]),_:1}),e(u,{prop:"status_code",label:"状态码",width:"100",align:"center"},{default:n(({row:l})=>[e(b,{size:"small",type:U(l.status_code)},{default:n(()=>[c(_(l.status_code),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"username",label:"用户",width:"120",align:"center"},{default:n(({row:l})=>[l.username?(h(),E("span",me,[e(p,null,{default:n(()=>[e(w(ne))]),_:1}),c(" "+_(l.username),1)])):(h(),E("span",fe,"匿名"))]),_:1}),e(u,{prop:"created_at",label:"时间",width:"180",align:"center"},{default:n(({row:l})=>[c(_(M(l.created_at)),1)]),_:1})]),_:1},8,["data"])),[[A,y.value]])]),r("div",he,[e(H,{"current-page":i.page,"onUpdate:currentPage":a[4]||(a[4]=l=>i.page=l),"page-size":i.size,"onUpdate:pageSize":a[5]||(a[5]=l=>i.size=l),total:g.value.length,"page-sizes":[50,100,200,500],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:P,onSizeChange:k},null,8,["current-page","page-size","total"])])])])])}}},Te=G(ye,[["__scopeId","data-v-6447954d"]]);export{Te as default};
