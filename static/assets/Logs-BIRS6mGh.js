import{_ as S,r as z,a as I,M,m as N,c as m,o as _,b as o,d as t,w as s,h as i,p as U,q as h,N as V,g as j,C as A,t as O,v as q,x as G,y as H,z as J,A as c,K,D as F,O as Q,I as w,k as y,J as R}from"../index.js";/* empty css                        *//* empty css                 */const W={class:"content-card"},X={class:"card-header"},Y={style:{display:"flex",gap:"12px"}},Z={class:"card-body"},$={class:"table-container"},ee={style:{"font-family":"monospace","font-size":"12px","word-break":"break-all"}},te={key:0},ae={key:1,style:{color:"#909399"}},ne={style:{"margin-top":"16px",display:"flex","justify-content":"center"}},se={__name:"Logs",setup(oe){const u=z(!1),p=z([]),l=I({page:1,size:100}),x=M(()=>{const e=(l.page-1)*l.size,n=e+l.size;return p.value.slice(e,n)}),g=async()=>{u.value=!0;try{const e=await w.get("/api/logs?limit=1000");p.value=e.data||[],p.value.sort((n,d)=>new Date(d.created_at)-new Date(n.created_at))}catch(e){y.error("加载访问日志失败"),console.error(e)}finally{u.value=!1}},b=e=>{l.page=e},E=e=>{l.size=e,l.page=1},T=async()=>{try{await R.confirm("确认清空所有访问日志吗？此操作不可恢复。","确认清空",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await w.delete("/api/logs"),y.success("日志清空成功"),g()}catch(e){e!=="cancel"&&(y.error("清空失败"),console.error(e))}},C=e=>({GET:"",POST:"success",PUT:"warning",DELETE:"danger",HEAD:"info"})[e]||"",D=e=>e>=200&&e<300?"success":e>=300&&e<400?"warning":e>=400&&e<500||e>=500?"danger":"",k=e=>e?new Date(e).toLocaleString("zh-CN"):"";return N(()=>{g()}),(e,n)=>{const d=U,v=j,r=H,f=J,B=F,L=Q,P=q;return _(),m("div",null,[n[5]||(n[5]=o("div",{class:"page-header"},[o("h2",{class:"page-title"},"访问日志"),o("p",{class:"page-description"},"查看系统访问记录和用户行为")],-1)),o("div",W,[o("div",X,[n[4]||(n[4]=o("h3",{class:"card-title"},"访问记录",-1)),o("div",Y,[t(v,{onClick:g},{default:s(()=>[t(d,null,{default:s(()=>[t(h(V))]),_:1}),n[2]||(n[2]=i(" 刷新 ",-1))]),_:1,__:[2]}),t(v,{onClick:T,type:"danger",plain:""},{default:s(()=>[t(d,null,{default:s(()=>[t(h(A))]),_:1}),n[3]||(n[3]=i(" 清空日志 ",-1))]),_:1,__:[3]})])]),o("div",Z,[o("div",$,[O((_(),G(B,{data:x.value,stripe:"",style:{width:"100%"},"max-height":"600","empty-text":"暂无访问日志"},{default:s(()=>[t(r,{prop:"id",label:"ID",width:"80"}),t(r,{prop:"client_ip",label:"客户端IP",width:"140",align:"center"},{default:s(({row:a})=>[t(f,{size:"small",type:"info"},{default:s(()=>[i(c(a.client_ip),1)]),_:2},1024)]),_:1}),t(r,{prop:"method",label:"方法",width:"80",align:"center"},{default:s(({row:a})=>[t(f,{size:"small",type:C(a.method)},{default:s(()=>[i(c(a.method),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"path",label:"路径","min-width":"300"},{default:s(({row:a})=>[o("div",ee,c(a.path),1)]),_:1}),t(r,{prop:"status_code",label:"状态码",width:"100",align:"center"},{default:s(({row:a})=>[t(f,{size:"small",type:D(a.status_code)},{default:s(()=>[i(c(a.status_code),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"username",label:"用户",width:"120",align:"center"},{default:s(({row:a})=>[a.username?(_(),m("span",te,[t(d,null,{default:s(()=>[t(h(K))]),_:1}),i(" "+c(a.username),1)])):(_(),m("span",ae,"匿名"))]),_:1}),t(r,{prop:"created_at",label:"时间",width:"180",align:"center"},{default:s(({row:a})=>[i(c(k(a.created_at)),1)]),_:1})]),_:1},8,["data"])),[[P,u.value]])]),o("div",ne,[t(L,{"current-page":l.page,"onUpdate:currentPage":n[0]||(n[0]=a=>l.page=a),"page-size":l.size,"onUpdate:pageSize":n[1]||(n[1]=a=>l.size=a),total:p.value.length,"page-sizes":[50,100,200,500],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:b,onSizeChange:E},null,8,["current-page","page-size","total"])])])])])}}},ce=S(se,[["__scopeId","data-v-82051176"]]);export{ce as default};
