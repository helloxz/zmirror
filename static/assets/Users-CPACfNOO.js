import{r as i,a as U,o as H,c as J,b as $,d,e as a,w as l,f as u,E as K,u as v,p as Q,g as W,h as X,v as Y,i as Z,j as ee,F as ae,t as q,k as le,G as se,m as oe,n as re,q as te,s as ne,z as de,A as b,B as p,C as ue,D as ie}from"./index-rbSA6_ZY.js";/* empty css                        *//* empty css                   */const me={class:"content-card"},pe={class:"card-header"},fe={class:"card-body"},ce={class:"table-container"},we={style:{display:"flex","align-items":"center",gap:"8px"}},ye={__name:"Users",setup(ge){const y=i(!1),E=i([]),w=i(!1),V=i(!1),g=i(!1),x=i(!1),k=i(),r=U({username:"",password:"",confirmPassword:""}),P=i(),t=U({id:null,username:"",password:"",confirmPassword:""}),F=(o,e,n)=>{e!==r.password?n(new Error("两次输入的密码不一致")):n()},T=(o,e,n)=>{e!==t.password?n(new Error("两次输入的密码不一致")):n()},z={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:F,trigger:"blur"}]},R={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:T,trigger:"blur"}]},C=async()=>{y.value=!0;try{const o=await b.get("/api/users");E.value=o.data||[]}catch(o){p.error("加载用户失败"),console.error(o)}finally{y.value=!1}},I=()=>{Object.assign(r,{username:"",password:"",confirmPassword:""}),w.value=!0},N=o=>{Object.assign(t,{id:o.id,username:o.username,password:"",confirmPassword:""}),g.value=!0},S=async()=>{if(!(!k.value||!await k.value.validate().catch(()=>!1))){V.value=!0;try{await b.post("/api/users",{username:r.username,password:r.password}),p.success("添加成功"),w.value=!1,C()}catch(e){p.error("添加失败"),console.error(e)}finally{V.value=!1}}},j=async()=>{if(!(!P.value||!await P.value.validate().catch(()=>!1))){x.value=!0;try{await b.put(`/api/users/${t.id}`,{password:t.password}),p.success("密码修改成功"),g.value=!1}catch(e){p.error("密码修改失败"),console.error(e)}finally{x.value=!1}}},M=async o=>{try{await ue.confirm(`确认删除用户 "${o.username}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await b.delete(`/api/users/${o.id}`),p.success("删除成功"),C()}catch(e){e!=="cancel"&&(p.error("删除失败"),console.error(e))}},L=o=>o?new Date(o).toLocaleString("zh-CN"):"";return H(()=>{C()}),(o,e)=>{const n=K,m=W,_=ee,O=le,A=ie,f=ne,c=te,D=re,B=de,G=Y;return $(),J("div",null,[e[20]||(e[20]=d("div",{class:"page-header"},[d("h2",{class:"page-title"},"用户管理"),d("p",{class:"page-description"},"管理系统用户账户和权限")],-1)),d("div",me,[d("div",pe,[e[12]||(e[12]=d("h3",{class:"card-title"},"用户列表",-1)),a(m,{type:"primary",onClick:e[0]||(e[0]=s=>I())},{default:l(()=>[a(n,null,{default:l(()=>[a(v(Q))]),_:1}),e[11]||(e[11]=u(" 添加用户 ",-1))]),_:1,__:[11]})]),d("div",fe,[d("div",ce,[X(($(),Z(A,{data:E.value,stripe:"",style:{width:"100%"},"empty-text":"暂无用户数据"},{default:l(()=>[a(_,{prop:"id",label:"ID",width:"80"}),a(_,{prop:"username",label:"用户名","min-width":"200"},{default:l(({row:s})=>[d("div",we,[a(n,null,{default:l(()=>[a(v(ae))]),_:1}),d("span",null,q(s.username),1)])]),_:1}),a(_,{prop:"created_at",label:"创建时间",width:"180",align:"center"},{default:l(({row:s})=>[u(q(L(s.created_at)),1)]),_:1}),a(_,{label:"状态",width:"100",align:"center"},{default:l(()=>[a(O,{type:"success",size:"small"},{default:l(()=>e[13]||(e[13]=[u("正常",-1)])),_:1,__:[13]})]),_:1}),a(_,{label:"操作",width:"200",align:"center"},{default:l(({row:s})=>[a(m,{size:"small",onClick:h=>N(s)},{default:l(()=>[a(n,null,{default:l(()=>[a(v(se))]),_:1}),e[14]||(e[14]=u(" 修改密码 ",-1))]),_:2,__:[14]},1032,["onClick"]),a(m,{size:"small",type:"danger",onClick:h=>M(s)},{default:l(()=>[a(n,null,{default:l(()=>[a(v(oe))]),_:1}),e[15]||(e[15]=u(" 删除 ",-1))]),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,y.value]])])])]),a(B,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=s=>w.value=s),title:"添加用户",width:"500px",class:"form-dialog","close-on-click-modal":!1},{footer:l(()=>[a(m,{onClick:e[4]||(e[4]=s=>w.value=!1)},{default:l(()=>e[16]||(e[16]=[u("取消",-1)])),_:1,__:[16]}),a(m,{type:"primary",loading:V.value,onClick:S},{default:l(()=>e[17]||(e[17]=[u(" 保存 ",-1)])),_:1,__:[17]},8,["loading"])]),default:l(()=>[a(D,{ref_key:"formRef",ref:k,model:r,rules:z,"label-width":"100px",class:"form-container"},{default:l(()=>[a(c,{label:"用户名",prop:"username"},{default:l(()=>[a(f,{modelValue:r.username,"onUpdate:modelValue":e[1]||(e[1]=s=>r.username=s),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(c,{label:"密码",prop:"password"},{default:l(()=>[a(f,{modelValue:r.password,"onUpdate:modelValue":e[2]||(e[2]=s=>r.password=s),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),a(c,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(f,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=s=>r.confirmPassword=s),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(B,{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=s=>g.value=s),title:"修改密码",width:"500px",class:"form-dialog","close-on-click-modal":!1},{footer:l(()=>[a(m,{onClick:e[9]||(e[9]=s=>g.value=!1)},{default:l(()=>e[18]||(e[18]=[u("取消",-1)])),_:1,__:[18]}),a(m,{type:"primary",loading:x.value,onClick:j},{default:l(()=>e[19]||(e[19]=[u(" 保存 ",-1)])),_:1,__:[19]},8,["loading"])]),default:l(()=>[a(D,{ref_key:"passwordFormRef",ref:P,model:t,rules:R,"label-width":"100px",class:"form-container"},{default:l(()=>[a(c,{label:"用户名"},{default:l(()=>[a(f,{modelValue:t.username,"onUpdate:modelValue":e[6]||(e[6]=s=>t.username=s),disabled:""},null,8,["modelValue"])]),_:1}),a(c,{label:"新密码",prop:"password"},{default:l(()=>[a(f,{modelValue:t.password,"onUpdate:modelValue":e[7]||(e[7]=s=>t.password=s),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(c,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(f,{modelValue:t.confirmPassword,"onUpdate:modelValue":e[8]||(e[8]=s=>t.confirmPassword=s),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{ye as default};
