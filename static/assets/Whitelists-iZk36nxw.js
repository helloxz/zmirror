import{_ as M,r as u,a as S,m as U,c as j,o as E,b as s,d as t,w as l,h as i,n as L,p as V,q as R,g as W,s as G,v as H,t as O,x as A,y as J,z as v,B as K,C as P,j as Q,E as X,e as Y,F as Z,G as ee,H as x,k as p,I as te}from"./index-B5CDqZvv.js";/* empty css                        *//* empty css                   *//* empty css                     *//* empty css                  *//* empty css                 */const le={class:"content-card"},ae={class:"card-header"},oe={class:"card-body"},se={class:"table-container"},ne={__name:"Whitelists",setup(ie){const f=u(!1),b=u([]),r=u(!1),m=u(!1),_=u(),n=S({prefix:"",enabled:!0}),k={prefix:[{required:!0,message:"请输入镜像前缀",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}]},g=async()=>{f.value=!0;try{const o=await x.get("/api/whitelists");b.value=o.data||[]}catch(o){p.error("加载白名单失败"),console.error(o)}finally{f.value=!1}},z=()=>{Object.assign(n,{prefix:"",enabled:!0}),r.value=!0},B=async()=>{if(!(!_.value||!await _.value.validate().catch(()=>!1))){m.value=!0;try{await x.post("/api/whitelists",n),p.success("添加成功"),r.value=!1,g()}catch(e){p.error("添加失败"),console.error(e)}finally{m.value=!1}}},C=async o=>{try{await te.confirm(`确认删除白名单 "${o.prefix}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await x.delete(`/api/whitelists/${o.id}`),p.success("删除成功"),g()}catch(e){e!=="cancel"&&(p.error("删除失败"),console.error(e))}},D=o=>o?new Date(o).toLocaleString("zh-CN"):"";return U(()=>{g()}),(o,e)=>{const y=L,c=W,d=A,w=J,I=P,T=Y,h=X,$=Z,N=Q,q=ee,F=H;return E(),j("div",null,[e[11]||(e[11]=s("div",{class:"page-header"},[s("h2",{class:"page-title"},"白名单管理"),s("p",{class:"page-description"},"配置允许访问的镜像前缀白名单")],-1)),s("div",le,[s("div",ae,[e[6]||(e[6]=s("h3",{class:"card-title"},"白名单列表",-1)),t(c,{type:"primary",onClick:e[0]||(e[0]=a=>z())},{default:l(()=>[t(y,null,{default:l(()=>[t(V(R))]),_:1}),e[5]||(e[5]=i(" 添加白名单 ",-1))]),_:1,__:[5]})]),s("div",oe,[s("div",se,[G((E(),O(I,{data:b.value,stripe:"",style:{width:"100%"},"empty-text":"暂无白名单数据"},{default:l(()=>[t(d,{prop:"id",label:"ID",width:"80"}),t(d,{prop:"prefix",label:"镜像前缀","min-width":"300"},{default:l(({row:a})=>[t(w,{type:"info",size:"small",style:{"margin-right":"8px"}},{default:l(()=>[i(v(a.prefix),1)]),_:2},1024)]),_:1}),t(d,{prop:"enabled",label:"状态",width:"100",align:"center"},{default:l(({row:a})=>[t(w,{type:a.enabled?"success":"danger",size:"small"},{default:l(()=>[i(v(a.enabled?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"created_at",label:"创建时间",width:"180",align:"center"},{default:l(({row:a})=>[i(v(D(a.created_at)),1)]),_:1}),t(d,{label:"操作",width:"120",align:"center"},{default:l(({row:a})=>[t(c,{size:"small",type:"danger",onClick:re=>C(a)},{default:l(()=>[t(y,null,{default:l(()=>[t(V(K))]),_:1}),e[7]||(e[7]=i(" 删除 ",-1))]),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[F,f.value]])])])]),t(q,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value=a),title:"添加白名单",width:"500px",class:"form-dialog","close-on-click-modal":!1},{footer:l(()=>[t(c,{onClick:e[3]||(e[3]=a=>r.value=!1)},{default:l(()=>e[9]||(e[9]=[i("取消",-1)])),_:1,__:[9]}),t(c,{type:"primary",loading:m.value,onClick:B},{default:l(()=>e[10]||(e[10]=[i(" 保存 ",-1)])),_:1,__:[10]},8,["loading"])]),default:l(()=>[t(N,{ref_key:"formRef",ref:_,model:n,rules:k,"label-width":"100px",class:"form-container"},{default:l(()=>[t(h,{label:"镜像前缀",prop:"prefix"},{default:l(()=>[t(T,{modelValue:n.prefix,"onUpdate:modelValue":e[1]||(e[1]=a=>n.prefix=a),placeholder:"例如：helloxz、nginx、mysql"},null,8,["modelValue"]),e[8]||(e[8]=s("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}},' 支持完整镜像名或前缀匹配，如 "helloxz" 将匹配 "helloxz/app:latest" ',-1))]),_:1,__:[8]}),t(h,{label:"状态"},{default:l(()=>[t($,{modelValue:n.enabled,"onUpdate:modelValue":e[2]||(e[2]=a=>n.enabled=a),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},_e=M(ne,[["__scopeId","data-v-c0159d72"]]);export{_e as default};
