import{_ as H,r as i,a as U,m as J,c as K,o as $,n as G,b as p,d as a,w as s,h as d,p as Q,q as _,s as X,g as Y,t as Z,v as ee,x as ae,y as se,K as le,A as q,z as oe,L as re,C as te,D as ne,j as de,E as ie,e as ue,H as pe,I as b,k as m,J as me}from"../index.js";/* empty css                        *//* empty css                   *//* empty css                     *//* empty css                 */const fe={class:"content-card"},ce={class:"card-header"},ve={class:"card-body"},we={class:"table-container"},ge={style:{display:"flex","align-items":"center",gap:"8px"}},_e={__name:"Users",setup(be){const y=i(!1),C=i([]),v=i(!1),V=i(!1),w=i(!1),x=i(!1),k=i(),r=U({username:"",password:"",confirmPassword:""}),E=i(),t=U({id:null,username:"",password:"",confirmPassword:""}),I=(o,e,n)=>{e!==r.password?n(new Error("两次输入的密码不一致")):n()},T=(o,e,n)=>{e!==t.password?n(new Error("两次输入的密码不一致")):n()},z={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:I,trigger:"blur"}]},F={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:T,trigger:"blur"}]},P=async()=>{y.value=!0;try{const o=await b.get("/api/users");C.value=o.data||[]}catch(o){m.error("加载用户失败"),console.error(o)}finally{y.value=!1}},N=()=>{Object.assign(r,{username:"",password:"",confirmPassword:""}),v.value=!0},R=o=>{Object.assign(t,{id:o.id,username:o.username,password:"",confirmPassword:""}),w.value=!0},S=async()=>{if(!(!k.value||!await k.value.validate().catch(()=>!1))){V.value=!0;try{await b.post("/api/users",{username:r.username,password:r.password}),m.success("添加成功"),v.value=!1,P()}catch(e){m.error("添加失败"),console.error(e)}finally{V.value=!1}}},j=async()=>{if(!(!E.value||!await E.value.validate().catch(()=>!1))){x.value=!0;try{await b.put(`/api/users/${t.id}`,{password:t.password}),m.success("密码修改成功"),w.value=!1}catch(e){m.error("密码修改失败"),console.error(e)}finally{x.value=!1}}},L=async o=>{try{await me.confirm(`确认删除用户 "${o.username}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await b.delete(`/api/users/${o.id}`),m.success("删除成功"),P()}catch(e){e!=="cancel"&&(m.error("删除失败"),console.error(e))}},M=o=>o?new Date(o).toLocaleString("zh-CN"):"";return J(()=>{P()}),(o,e)=>{const n=Q,u=Y,g=se,h=oe,O=ne,f=ue,c=ie,D=de,B=pe,W=ee;return $(),K("div",null,[e[20]||(e[20]=G('<div class="page-header" data-v-86f0b479><h2 class="page-title" data-v-86f0b479>用户管理</h2><p class="page-description" data-v-86f0b479>管理系统用户账户和权限</p></div><div class="permission-info" data-v-86f0b479><div class="info-header" data-v-86f0b479><span class="info-title" data-v-86f0b479>用户权限说明</span></div><div class="info-content" data-v-86f0b479><div class="permission-item" data-v-86f0b479><span class="permission-type" data-v-86f0b479>管理员用户：</span><span class="permission-desc" data-v-86f0b479>可以登录WEB管理界面，但无法进行docker login登录。</span></div><div class="permission-item" data-v-86f0b479><span class="permission-type" data-v-86f0b479>普通用户：</span><span class="permission-desc" data-v-86f0b479>可通过docker login登录并拉取镜像，但无法登录WEB管理界面。</span></div><div class="permission-item" data-v-86f0b479><span class="permission-type" data-v-86f0b479>备注：</span><span class="permission-desc" data-v-86f0b479>此处创建的用户为普通用户！</span></div></div></div>',2)),p("div",fe,[p("div",ce,[e[12]||(e[12]=p("h3",{class:"card-title"},"用户列表",-1)),a(u,{type:"primary",onClick:e[0]||(e[0]=l=>N())},{default:s(()=>[a(n,null,{default:s(()=>[a(_(X))]),_:1}),e[11]||(e[11]=d(" 添加用户 ",-1))]),_:1,__:[11]})]),p("div",ve,[p("div",we,[Z(($(),ae(O,{data:C.value,stripe:"",style:{width:"100%"},"empty-text":"暂无用户数据"},{default:s(()=>[a(g,{prop:"id",label:"ID",width:"80"}),a(g,{prop:"username",label:"用户名","min-width":"200"},{default:s(({row:l})=>[p("div",ge,[a(n,null,{default:s(()=>[a(_(le))]),_:1}),p("span",null,q(l.username),1)])]),_:1}),a(g,{prop:"created_at",label:"创建时间",width:"180",align:"center"},{default:s(({row:l})=>[d(q(M(l.created_at)),1)]),_:1}),a(g,{label:"状态",width:"100",align:"center"},{default:s(()=>[a(h,{type:"success",size:"small"},{default:s(()=>e[13]||(e[13]=[d("正常",-1)])),_:1,__:[13]})]),_:1}),a(g,{label:"操作",width:"200",align:"center"},{default:s(({row:l})=>[a(u,{size:"small",onClick:A=>R(l)},{default:s(()=>[a(n,null,{default:s(()=>[a(_(re))]),_:1}),e[14]||(e[14]=d(" 修改密码 ",-1))]),_:2,__:[14]},1032,["onClick"]),a(u,{size:"small",type:"danger",onClick:A=>L(l)},{default:s(()=>[a(n,null,{default:s(()=>[a(_(te))]),_:1}),e[15]||(e[15]=d(" 删除 ",-1))]),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,y.value]])])])]),a(B,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=l=>v.value=l),title:"添加用户",width:"500px",class:"form-dialog","close-on-click-modal":!1},{footer:s(()=>[a(u,{onClick:e[4]||(e[4]=l=>v.value=!1)},{default:s(()=>e[16]||(e[16]=[d("取消",-1)])),_:1,__:[16]}),a(u,{type:"primary",loading:V.value,onClick:S},{default:s(()=>e[17]||(e[17]=[d(" 保存 ",-1)])),_:1,__:[17]},8,["loading"])]),default:s(()=>[a(D,{ref_key:"formRef",ref:k,model:r,rules:z,"label-width":"100px",class:"form-container","label-position":"top"},{default:s(()=>[a(c,{label:"用户名",prop:"username"},{default:s(()=>[a(f,{modelValue:r.username,"onUpdate:modelValue":e[1]||(e[1]=l=>r.username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(c,{label:"密码",prop:"password"},{default:s(()=>[a(f,{modelValue:r.password,"onUpdate:modelValue":e[2]||(e[2]=l=>r.password=l),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),a(c,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[a(f,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=l=>r.confirmPassword=l),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(B,{modelValue:w.value,"onUpdate:modelValue":e[10]||(e[10]=l=>w.value=l),title:"修改密码",width:"500px",class:"form-dialog","close-on-click-modal":!1},{footer:s(()=>[a(u,{onClick:e[9]||(e[9]=l=>w.value=!1)},{default:s(()=>e[18]||(e[18]=[d("取消",-1)])),_:1,__:[18]}),a(u,{type:"primary",loading:x.value,onClick:j},{default:s(()=>e[19]||(e[19]=[d(" 保存 ",-1)])),_:1,__:[19]},8,["loading"])]),default:s(()=>[a(D,{ref_key:"passwordFormRef",ref:E,model:t,rules:F,"label-width":"100px",class:"form-container"},{default:s(()=>[a(c,{label:"用户名"},{default:s(()=>[a(f,{modelValue:t.username,"onUpdate:modelValue":e[6]||(e[6]=l=>t.username=l),disabled:""},null,8,["modelValue"])]),_:1}),a(c,{label:"新密码",prop:"password"},{default:s(()=>[a(f,{modelValue:t.password,"onUpdate:modelValue":e[7]||(e[7]=l=>t.password=l),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(c,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[a(f,{modelValue:t.confirmPassword,"onUpdate:modelValue":e[8]||(e[8]=l=>t.confirmPassword=l),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Pe=H(_e,[["__scopeId","data-v-86f0b479"]]);export{Pe as default};
