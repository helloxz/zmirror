import{_ as M,r as p,a as U,m as j,c as F,o as E,n as L,b as i,d as t,w as a,h as n,p as R,q as V,s as W,g as A,t as G,v as H,x as J,y as O,z as K,A as b,C as P,D as Q,j as X,E as Y,e as Z,G as ee,H as te,I as g,k as c,J as ae}from"./index.js";/* empty css                        *//* empty css                   *//* empty css                     *//* empty css                  *//* empty css                 */const le={class:"content-card"},se={class:"card-header"},oe={class:"card-body"},ne={class:"table-container"},ie={__name:"Whitelists",setup(re){const f=p(!1),x=p([]),r=p(!1),m=p(!1),_=p(),o=U({prefix:"",enabled:!0}),k={prefix:[{required:!0,message:"请输入镜像前缀",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}]},v=async()=>{f.value=!0;try{const s=await g.get("/api/whitelists");x.value=s.data||[]}catch(s){c.error("加载白名单失败"),console.error(s)}finally{f.value=!1}},D=()=>{Object.assign(o,{prefix:"",enabled:!0}),r.value=!0},z=async()=>{if(!(!_.value||!await _.value.validate().catch(()=>!1))){m.value=!0;try{await g.post("/api/whitelists",o),c.success("添加成功"),r.value=!1,v()}catch(e){c.error("添加失败"),console.error(e)}finally{m.value=!1}}},C=async s=>{try{await ae.confirm(`确认删除白名单 "${s.prefix}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await g.delete(`/api/whitelists/${s.id}`),c.success("删除成功"),v()}catch(e){e!=="cancel"&&(c.error("删除失败"),console.error(e))}},B=s=>s?new Date(s).toLocaleString("zh-CN"):"";return j(()=>{v()}),(s,e)=>{const y=R,u=A,d=O,w=K,I=Q,T=Z,h=Y,N=ee,$=X,S=te,q=H;return E(),F("div",null,[e[11]||(e[11]=L('<div class="page-header" data-v-5b76d40f><h2 class="page-title" data-v-5b76d40f>白名单管理</h2><p class="page-description" data-v-5b76d40f>配置允许访问的镜像前缀白名单</p></div><div class="permission-info" data-v-5b76d40f><div class="info-header" data-v-5b76d40f><span class="info-title" data-v-5b76d40f>白名单说明</span></div><div class="info-content" data-v-5b76d40f><div class="permission-item" data-v-5b76d40f><span class="permission-type" data-v-5b76d40f>注意：</span><span class="permission-desc" data-v-5b76d40f>白名单内的镜像可以匿名拉取，非白名单镜像必须使用docker login登录后才能拉取。</span></div></div></div>',2)),i("div",le,[i("div",se,[e[6]||(e[6]=i("h3",{class:"card-title"},"白名单列表",-1)),t(u,{type:"primary",onClick:e[0]||(e[0]=l=>D())},{default:a(()=>[t(y,null,{default:a(()=>[t(V(W))]),_:1}),e[5]||(e[5]=n(" 添加白名单 ",-1))]),_:1,__:[5]})]),i("div",oe,[i("div",ne,[G((E(),J(I,{data:x.value,stripe:"",style:{width:"100%"},"empty-text":"暂无白名单数据"},{default:a(()=>[t(d,{prop:"id",label:"ID",width:"80"}),t(d,{prop:"prefix",label:"镜像前缀","min-width":"300"},{default:a(({row:l})=>[t(w,{type:"info",size:"small",style:{"margin-right":"8px"}},{default:a(()=>[n(b(l.prefix),1)]),_:2},1024)]),_:1}),t(d,{prop:"enabled",label:"状态",width:"100",align:"center"},{default:a(({row:l})=>[t(w,{type:l.enabled?"success":"danger",size:"small"},{default:a(()=>[n(b(l.enabled?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"created_at",label:"创建时间",width:"180",align:"center"},{default:a(({row:l})=>[n(b(B(l.created_at)),1)]),_:1}),t(d,{label:"操作",width:"120",align:"center"},{default:a(({row:l})=>[t(u,{size:"small",type:"danger",onClick:de=>C(l)},{default:a(()=>[t(y,null,{default:a(()=>[t(V(P))]),_:1}),e[7]||(e[7]=n(" 删除 ",-1))]),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,f.value]])])])]),t(S,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=l=>r.value=l),title:"添加白名单",width:"500px",class:"form-dialog","close-on-click-modal":!1},{footer:a(()=>[t(u,{onClick:e[3]||(e[3]=l=>r.value=!1)},{default:a(()=>e[9]||(e[9]=[n("取消",-1)])),_:1,__:[9]}),t(u,{type:"primary",loading:m.value,onClick:z},{default:a(()=>e[10]||(e[10]=[n(" 保存 ",-1)])),_:1,__:[10]},8,["loading"])]),default:a(()=>[t($,{ref_key:"formRef",ref:_,model:o,rules:k,"label-width":"100px",class:"form-container","label-position":"top"},{default:a(()=>[t(h,{label:"镜像前缀",prop:"prefix"},{default:a(()=>[t(T,{modelValue:o.prefix,"onUpdate:modelValue":e[1]||(e[1]=l=>o.prefix=l),placeholder:"例如：helloxz、nginx、mysql"},null,8,["modelValue"]),e[8]||(e[8]=i("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}},' 支持完整镜像名或前缀匹配，如 "helloxz" 将匹配 "helloxz/app:latest" ',-1))]),_:1,__:[8]}),t(h,{label:"状态"},{default:a(()=>[t(N,{modelValue:o.enabled,"onUpdate:modelValue":e[2]||(e[2]=l=>o.enabled=l),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ve=M(ie,[["__scopeId","data-v-5b76d40f"]]);export{ve as default};
