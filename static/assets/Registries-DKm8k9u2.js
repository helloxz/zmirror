import{_ as S,r as i,a as j,m as q,c as F,o as k,n as M,b as n,d as t,w as l,h as r,p as O,q as x,s as A,g as G,t as H,v as J,x as Z,y as K,z as P,A as Q,B as W,C as X,D as Y,j as ee,E as te,e as le,F as ae,G as se,H as oe,I as V,k as p,J as ie}from"./index.js";/* empty css                        *//* empty css                   *//* empty css                     *//* empty css                  *//* empty css                 */const ne={class:"content-card"},re={class:"card-header"},de={class:"card-body"},ce={class:"table-container"},ue={__name:"Registries",setup(pe){const v=i(!1),w=i([]),d=i(!1),_=i(""),f=i(!1),b=i(),s=j({id:null,url:"",priority:1,enabled:!0}),C={url:[{required:!0,message:"请输入镜像源URL",trigger:"blur"},{type:"url",message:"请输入有效的URL",trigger:"blur"}],priority:[{required:!0,message:"请输入优先级",trigger:"blur"},{type:"number",min:1,max:100,message:"优先级必须在1-100之间",trigger:"blur"}]},g=async()=>{v.value=!0;try{const o=await V.get("/api/registries");w.value=o.data||[]}catch(o){p.error("加载镜像源失败"),console.error(o)}finally{v.value=!1}},E=(o=null)=>{o?(_.value="编辑镜像源",Object.assign(s,o)):(_.value="添加镜像源",Object.assign(s,{id:null,url:"",priority:1,enabled:!0})),d.value=!0},B=async()=>{if(!(!b.value||!await b.value.validate().catch(()=>!1))){f.value=!0;try{const e=s.id!==null;await V[e?"put":"post"]("/api/registries",s),p.success(e?"更新成功":"添加成功"),d.value=!1,g()}catch(e){p.error("保存失败"),console.error(e)}finally{f.value=!1}}},D=async o=>{try{await ie.confirm(`确认删除镜像源 "${o.url}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await V.delete(`/api/registries/${o.id}`),p.success("删除成功"),g()}catch(e){e!=="cancel"&&(p.error("删除失败"),console.error(e))}};return q(()=>{g()}),(o,e)=>{const m=O,c=G,u=K,R=P,U=Y,h=le,y=te,I=ae,T=se,L=ee,$=oe,z=J;return k(),F("div",null,[e[13]||(e[13]=M('<div class="page-header" data-v-45c40cb5><h2 class="page-title" data-v-45c40cb5>镜像源管理</h2><p class="page-description" data-v-45c40cb5>管理上游Docker镜像源配置</p></div><div class="permission-info" data-v-45c40cb5><div class="info-header" data-v-45c40cb5><span class="info-title" data-v-45c40cb5>镜像源配置说明</span></div><div class="info-content" data-v-45c40cb5><div class="permission-item" data-v-45c40cb5><span class="permission-type" data-v-45c40cb5>优先级规则：</span><span class="permission-desc" data-v-45c40cb5>数字越小，优先级越高。</span></div><div class="permission-item" data-v-45c40cb5><span class="permission-type" data-v-45c40cb5>查找机制：</span><span class="permission-desc" data-v-45c40cb5>可添加多个镜像源，Zmirror将根据优先级依次查找镜像，知道匹配为止！</span></div></div></div>',2)),n("div",ne,[n("div",re,[e[7]||(e[7]=n("h3",{class:"card-title"},"镜像源列表",-1)),t(c,{type:"primary",onClick:e[0]||(e[0]=a=>E())},{default:l(()=>[t(m,null,{default:l(()=>[t(x(A))]),_:1}),e[6]||(e[6]=r(" 添加镜像源 ",-1))]),_:1,__:[6]})]),n("div",de,[n("div",ce,[H((k(),Z(U,{data:w.value,stripe:"",style:{width:"100%"},"empty-text":"暂无镜像源数据"},{default:l(()=>[t(u,{prop:"id",label:"ID",width:"80"}),t(u,{prop:"url",label:"镜像源URL","min-width":"300"}),t(u,{prop:"priority",label:"优先级",width:"100",align:"center"}),t(u,{prop:"enabled",label:"状态",width:"100",align:"center"},{default:l(({row:a})=>[t(R,{type:a.enabled?"success":"danger",size:"small"},{default:l(()=>[r(Q(a.enabled?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(u,{label:"操作",width:"180",align:"center"},{default:l(({row:a})=>[t(c,{size:"small",onClick:N=>E(a)},{default:l(()=>[t(m,null,{default:l(()=>[t(x(W))]),_:1}),e[8]||(e[8]=r(" 编辑 ",-1))]),_:2,__:[8]},1032,["onClick"]),t(c,{size:"small",type:"danger",onClick:N=>D(a)},{default:l(()=>[t(m,null,{default:l(()=>[t(x(X))]),_:1}),e[9]||(e[9]=r(" 删除 ",-1))]),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[z,v.value]])])])]),t($,{modelValue:d.value,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value=a),title:_.value,width:"500px",class:"form-dialog","close-on-click-modal":!1},{footer:l(()=>[t(c,{onClick:e[4]||(e[4]=a=>d.value=!1)},{default:l(()=>e[11]||(e[11]=[r("取消",-1)])),_:1,__:[11]}),t(c,{type:"primary",loading:f.value,onClick:B},{default:l(()=>e[12]||(e[12]=[r(" 保存 ",-1)])),_:1,__:[12]},8,["loading"])]),default:l(()=>[t(L,{ref_key:"formRef",ref:b,model:s,rules:C,"label-width":"100px",class:"form-container","label-position":"top"},{default:l(()=>[t(y,{label:"URL",prop:"url"},{default:l(()=>[t(h,{modelValue:s.url,"onUpdate:modelValue":e[1]||(e[1]=a=>s.url=a),placeholder:"请输入镜像源URL，例如：https://registry-1.docker.io"},null,8,["modelValue"])]),_:1}),t(y,{label:"优先级",prop:"priority"},{default:l(()=>[t(I,{modelValue:s.priority,"onUpdate:modelValue":e[2]||(e[2]=a=>s.priority=a),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"]),e[10]||(e[10]=n("div",{style:{"font-size":"12px",color:"#909399","margin-top":"4px"}}," 数值越小优先级越高 ",-1))]),_:1,__:[10]}),t(y,{label:"状态"},{default:l(()=>[t(T,{modelValue:s.enabled,"onUpdate:modelValue":e[3]||(e[3]=a=>s.enabled=a),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ye=S(ue,[["__scopeId","data-v-45c40cb5"]]);export{ye as default};
