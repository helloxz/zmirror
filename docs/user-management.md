# 用户管理设计

## 用户类型

### 管理员用户
- **存储位置**: 配置文件 `data/config.toml`
- **配置项**: 
  ```toml
  [admin]
  username = "admin"
  password = "admin456"
  ```
- **特点**: 
  - 只有一个管理员账号
  - 账号密码明文存储在配置文件中
  - 具有所有权限，可以管理普通用户、镜像源、白名单等

### 普通用户
- **存储位置**: SQLite 数据库 `data/registry.db`
- **特点**:
  - 可以有多个普通用户
  - 密码使用MD5哈希存储
  - 只能用于Docker镜像拉取认证
  - 不能访问管理界面

## 认证流程

### Docker Registry 认证
1. 检查镜像是否在白名单中，如果是则直接允许访问
2. 如果不在白名单中，要求Basic认证
3. 先检查是否为管理员账号（配置文件）
4. 如果不是管理员，则查询数据库中的普通用户
5. 认证成功后允许访问

### 管理界面认证
1. 要求Basic认证
2. 验证用户名密码
3. 检查是否为管理员（`IsAdmin` 字段为true）
4. 只有管理员可以访问管理界面

## API说明

- `/api/users` - 管理普通用户（增删查）
- `/api/registries` - 管理镜像源
- `/api/whitelists` - 管理白名单
- `/api/logs` - 查看访问日志

所有管理API都需要管理员认证。
